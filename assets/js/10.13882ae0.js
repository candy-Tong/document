(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{170:function(t,s,a){"use strict";a.r(s);var e=a(0),r=Object(e.a)({},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"content"},[t._m(0),t._v(" "),t._m(1),t._v(" "),t._m(2),t._v(" "),a("p",[t._v("在生产环境中，常常会发生错误，开发者需要知道")]),t._v(" "),t._m(3),t._v(" "),a("p",[t._v("为了达到以上目的，需要约定好的错误码规范，错误码不同的位数代表着不同的意义。")]),t._v(" "),a("p",[t._v("在前后端开发协作中，发生错误的信息并不适合直接显示在前端，这些错误信息对于用户是无意义的，而且增加了系统被攻击的风险，前端需要匹配后台返回的错误码，并作出相应的适合用户的错误提示")]),t._v(" "),t._m(4),t._v(" "),a("p",[t._v("我们约定了如下的错误码格式：")]),t._v(" "),t._m(5),t._v(" "),a("p",[t._v("如果错误码未被登记，框架会自动把未登记部分置为0，即如果某一错误码片段为全0，则该部分的错误码没有被登记")]),t._v(" "),t._m(6),t._v(" "),a("p",[t._v("我们约定了统一的错误响应格式")]),t._v(" "),a("p",[t._v("当"),a("router-link",{attrs:{to:"/框架原理/中间件.html#errCacth"}},[t._v("errCatch")]),t._v("中间件检测到全局未捕获的错误时，能将其捕获，并对请求做出统一的响应")],1),t._v(" "),t._m(7),t._m(8),t._v(" "),t._m(9),t._v(" "),t._m(10),t._v(" "),t._m(11),t._v(" "),t._m(12),t._m(13),t._v(" "),t._m(14),a("p",[t._v("具体实现见"),a("router-link",{attrs:{to:"/框架原理/扩展.html#createError"}},[t._v("扩展")])],1),t._v(" "),t._m(15),t._v(" "),t._m(16),t._v(" "),a("p",[t._v("在使用错误码前需要进行配置，登记错误码的映射规则，需要在全局配置文件下新增如下配置")]),t._v(" "),t._m(17),t._m(18),t._v(" "),t._m(19),t._v(" "),t._m(20),a("p",[t._v("配置之后，能够从"),a("code",[t._v("app.errCode")]),t._v("中读取错误码，框架能将错误码自动合并（3-6位和7-8位，1-2位"),a("code",[t._v("createError")]),t._v("函数会进行合并），具体实现见"),a("router-link",{attrs:{to:"/框架原理/其他.html#框架启动"}},[t._v("框架原理")])],1),t._v(" "),a("p",[t._v("例如：")]),t._v(" "),t._m(21),t._m(22),t._v(" "),t._m(23),t._m(24),t._v(" "),t._m(25),t._v(" "),t._m(26)])},[function(){var t=this.$createElement,s=this._self._c||t;return s("h1",{attrs:{id:"错误码"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#错误码","aria-hidden":"true"}},[this._v("#")]),this._v(" 错误码")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("错误码可以定义为"),s("strong",[this._v("一组数字(或字母与数字的结合)，它会与错误讯息建立关联，用于识别在系统中出现的各种异常情况")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"为什么需要错误码"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#为什么需要错误码","aria-hidden":"true"}},[this._v("#")]),this._v(" 为什么需要错误码")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[s("p",[this._v("哪个系统出问题")])]),this._v(" "),s("li",[s("p",[this._v("出现了什么错误")])]),this._v(" "),s("li",[s("p",[this._v("前端该如何显示该错误给用户")]),this._v(" "),s("p",[this._v("……")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"错误码格式"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#错误码格式","aria-hidden":"true"}},[this._v("#")]),this._v(" 错误码格式")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ul",[a("li",[t._v("1-2位 —— 代表发生错误的后台，在线上服务中，我们的后台服务可能不止一个")]),t._v(" "),a("li",[t._v("3-8位 —— 具体业务错误码\n"),a("ul",[a("li",[t._v("3-3位 —— 1 代表 错误发生在Controller，2 代表错误发生在service，3代表错误发生在Middleware")]),t._v(" "),a("li",[t._v("4-6位 —— 代表具体的 Controller / Service / Middleware")]),t._v(" "),a("li",[t._v("7-8位 —— 具体的业务错误码")])])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"请求响应格式"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#请求响应格式","aria-hidden":"true"}},[this._v("#")]),this._v(" 请求响应格式")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\tcode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"01020304"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\tmessage"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"error message"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 可选，默认不发送错误信息至客户端")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("如果code为字符串"),s("code",[this._v("0")]),this._v("，则代表没有错误")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("注意：如果code有多个字符串"),s("code",[this._v("0")]),this._v("，则代表该错误没有被登记")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"抛出错误"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#抛出错误","aria-hidden":"true"}},[this._v("#")]),this._v(" 抛出错误")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("我们封装了一个方法"),s("code",[this._v("ctx.helper.createError()")]),this._v("，用来生成带有错误码信息的Error对象")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-JavaScript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n * 创建一个带有错误码的Error对象\n * @param msg 错误信息\n * @param code 3-8位错误码\n * @param arg_props 其他混入到Error对象的属性\n * @returns {Error} 返回带错误码的Error对象\n */")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("createError")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("msg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" arg_props"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("使用"),s("code",[this._v("throw")]),this._v("抛出"),s("code",[this._v("createError")]),this._v("所返回的错误，如果该错误没有被手动捕获，将会被"),s("code",[this._v("errCode")]),this._v("中间件捕获，并结束该请求，返回规定的错误码响应格式")])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[this._v("throw ctx.helper.createError('error message', your_error_code )\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#配置","aria-hidden":"true"}},[this._v("#")]),this._v(" 配置")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"全局配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#全局配置","aria-hidden":"true"}},[this._v("#")]),this._v(" 全局配置")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// config/config.default.js")]),t._v("\nmodule"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    errCode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("APP_ERROR_CODE")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'01'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("   "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 应用错误码，错误码1-2位，其他为3-6位")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("NOT_REGISTER_ERROR")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'0000'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 未登记默认错误码")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"错误码文件配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#错误码文件配置","aria-hidden":"true"}},[this._v("#")]),this._v(" 错误码文件配置")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("配置文件位于"),s("code",[this._v("config/errCode.js")]),this._v("，用于填写对应的错误码，具体格式如下")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-JavaScript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// config/errCode.js")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" errCode "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    testController"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'1001'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 3-6位")]),t._v("\n        error1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'01'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 7-8位")]),t._v("\n        error2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'02'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 7-8位")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\nmodule"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" errCode\n")])])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[t._v("app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("errCode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("testController"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("error1 "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'100101'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// true")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("配合"),s("code",[this._v("createError")]),this._v("会用：")])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[this._v("throw ctx.helper.createError('error message', app.errCode.testController.error1)\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"给客户端返回错误信息"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#给客户端返回错误信息","aria-hidden":"true"}},[this._v("#")]),this._v(" 给客户端返回错误信息")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("p",[t._v("默认不发送错误信息说明到客户端\n可以通过在配置里设置配置"),a("code",[t._v("errCatch")]),t._v("中间件，"),a("code",[t._v("responseErrorMsg")]),t._v("属性设为"),a("code",[t._v("true")]),t._v("，将"),a("code",[t._v("ctx.helper.createError()")]),t._v("创建的错误对象的错误信息返回到客户端")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// config/config.default.js")]),t._v("\nmodule"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n     errCatch"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        responseErrorMsg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])}],!1,null,null,null);s.default=r.exports}}]);